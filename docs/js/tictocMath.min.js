var agentE,operator,agentName,logNumber,useNegatives,globalItems=[];function GenerateMainView(e){$("#mainRow").empty(),$("#itemTempate").tmpl(e).appendTo("#mainRow")}function nextAgent(e){e&&clippy.load(e,a=>{window[e]=a,a.show(),a.speak("Hello, My name is "+e+". Ready to play some Tic Tac Math?"),agentE=a})}function swapAgent(e){localStorage.setItem("agentName",e),agentE.hide(),nextAgent(e)}function swapOperator(e){operator=e,localStorage.setItem("operator",e),LoadPage(e)}function swapPlaceHolder(e){console.log("swapPlaceholder"),logNumber=e,localStorage.setItem("placeholder",e),LoadPage(operator)}function LoadPage(e){GenerateMainView(globalItems=Array.from(new Array(9),(e,a)=>generateModel(operator,a)))}function generateModel(e,a){console.log(e);let t=getRndInteger(1,Math.pow(10,logNumber)),o=getRndInteger(1,Math.pow(10,logNumber));switch(e){case"รท":t*=o;break;case"-":if(t<o){let e=t;t=o,o=e}}return{Number1:t,Number2:o,Checked:"N",id:a}}function PlayerMove(){if(MoreMoves()){let e=globalItems.filter(e=>"N"===e.Checked),a=1==e.length?e[0].id:e[getRndInteger(0,e.length)].id,t=$("#txtBox"+a);MoveAgent(t[0]),MarkCard("C",a);let o=globalItems[a],r=CalculateValue(o);t.val(r),o.Checked="C",speak(o.Number1.toString()+GetOperatorText()+o.Number2.toString()+" equals "+CalculateValue(o)),t.prop("disabled",!0),CheckForWin()}}function CheckForWin(){let e=CheckForWinItems();return(""!=e||!MoreMoves())&&(animateWin(e),LoadPage(operator),!0)}function MoreMoves(){return globalItems.some(e=>"N"===e.Checked)}function getRndInteger(e,a){return Math.floor(Math.random()*(a-e))+e}function allEqual(e){return e.every(a=>a===e[0])}function GetFromStorage(e,a){return null===localStorage.getItem(e)?a:localStorage.getItem(e)}function CalculateValue(e){switch(operator){case"+":return e.Number1+e.Number2;case"-":return e.Number1-e.Number2;case"x":return e.Number1*e.Number2;default:return e.Number1/e.Number2}}function CheckForWinItems(){let e=globalItems.map(e=>e.Checked);return"N"!=e[0]&&allEqual([0,1,2].map(a=>e[a]))?e[0]:"N"!=e[0]&&allEqual([0,3,6].map(a=>e[a]))?e[0]:"N"!=e[0]&&allEqual([0,4,8].map(a=>e[a]))?e[0]:"N"!=e[1]&&allEqual([1,4,7].map(a=>e[a]))?e[1]:"N"!=e[2]&&allEqual([2,5,8].map(a=>e[a]))?e[2]:"N"!=e[2]&&allEqual([2,4,6].map(a=>e[a]))?e[2]:"N"!=e[3]&&allEqual([3,4,5].map(a=>e[a]))?e[3]:"N"!=e[6]&&allEqual([6,7,8].map(a=>e[a]))?e[6]:""}function animateWin(e){let a=agentE.animations();switch(e){case"U":a.includes("Congratulate")&&agentE.play("Congratulate"),speak("Congratulations, you won!"),console.log("win");break;case"C":a.includes("Think")&&agentE.play("Think"),a.includes("Wave")&&agentE.play("Wave"),speak("Sorry, I won, maybe next time!"),console.log("lose");break;default:a.includes("Searching")&&agentE.play("Searching"),speak("No more moves. Good game."),console.log("tie")}}function GetOperatorText(){switch(operator){case"+":return" plus ";case"-":return" minus ";case"x":return" times ";default:return" divided by "}}function speak(e){var a=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(a),agentE.speak(e)}function MoveAgent(e){agentE.stop();let a=e.getBoundingClientRect();agentE.moveTo(a.left,a.top)}function MarkCard(e,a){$("#card"+a).attr("class","U"==e?"card mb-4 box-shadow bg-info":"card mb-4 box-shadow bg-danger"),$("#btn"+a).prop("disabled",!0)}function Check(e){let a=parseInt($("#txtBox"+e).val());if(isNaN(a))speak("you need to enter a value. try again");else{let t=globalItems[e];console.log(t);let o=CalculateValue(t),r=GetOperatorText();o==a?(t.Checked="U",speak("Correct"),MarkCard("U",e)):(t.Checked="C",speak(t.Number1.toString()+r+t.Number2.toString()+" equals "+o.toString()),MarkCard("C",e)),CheckForWin()||PlayerMove()}}agentName=GetFromStorage("agentName","Merlin"),logNumber=GetFromStorage("logNumber",1),LoadPage(operator=GetFromStorage("operator","+")),nextAgent(agentName),$(document).on("touchstart click",".checkItem",function(e){if(console.log(e),!1===e.handled)return;e.stopPropagation(),e.preventDefault(),e.handled=!0,Check(e.target.id.substring(3))}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js");